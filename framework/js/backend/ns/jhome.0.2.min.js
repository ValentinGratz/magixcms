/**
 * MAGIX CMS
 * @copyright  MAGIX CMS Copyright (c) 2011 - 2012 Gerits Aurelien, 
 * http://www.magix-cms.com, http://www.magix-cjquery.com
 * @license    Dual licensed under the MIT or GPL Version 3 licenses.
 * @version    0.2
 * @author Gérits Aurélien <aurelien@magix-cms.com>
 * @name ns_jhome
 * @update 08/10/2011 21:34
 */
var ns_jhome={_initTextChange:function(){$.getScript("/framework/js/tools/jquery.jqEasyCharCounter.min.js",function(){$("#metatitle").jqEasyCounter({maxChars:120,maxCharsWarning:110,msgTextAlign:"left",msgFontSize:"12px",msgFontColor:"#FFF",msgAppendMethod:"insertAfter"});$("#metadescription").jqEasyCounter({maxChars:180,maxCharsWarning:170,msgTextAlign:"left",msgFontSize:"12px",msgFontColor:"#FFF",msgAppendMethod:"insertAfter"})})},_homePageList:function(){$.nicenotify({ntype:"ajax",uri:"/admin/home.php?json_list_home_page=true",typesend:"get",datatype:"json",beforeParams:function(){$("#list_home_page").html('<img class="loader-block" src="/framework/img/square-circle.gif" />')},successParams:function(a){$("#list_home_page").empty();$.nicenotify.initbox(a,{display:false});if(a===undefined){console.log(a)}if(a!==null){var b='<table id="table-list-home-page" class="table-widget-product"><thead><tr style="padding:3px;" class="ui-widget ui-widget-header"><th>ID</th><th><span class="lfloat magix-icon magix-icon-h1"></span>Titre</th><th><span class="lfloat magix-icon magix-icon-igoogle-t"></span></th><th><span class="lfloat magix-icon magix-icon-igoogle-d"></span></th><th><span class="lfloat ui-icon ui-icon-flag"></span></th><th><span class="lfloat ui-icon ui-icon-person"></span></th><th><span style="float:left;" class="ui-icon ui-icon-zoomin"></span></th><th><span class="lfloat ui-icon ui-icon-pencil"></span></th><th><span class="lfloat ui-icon ui-icon-close"></span></th></tr></thead><tbody>';b+="</tbody></table>";$(b).appendTo("#list_home_page");$.each(a,function(c,d){if(d.metatitle!=0){metaTitle='<div class="ui-state-highlight" style="border:none;"><span style="float:left" class="ui-icon ui-icon-check"></span></div>'}else{metaTitle='<div class="ui-state-error" style="border:none;"><span style="float:left;" class="ui-icon ui-icon-alert"></span></div>'}if(d.metadescription!=0){metaDesc='<div class="ui-state-highlight" style="border:none;"><span style="float:left" class="ui-icon ui-icon-check"></span></div>'}else{metaDesc='<div class="ui-state-error" style="border:none;"><span style="float:left;" class="ui-icon ui-icon-alert"></span></div>'}return $('<tr><td class="small-icon">'+d.idhome+'</td><td class="medium-cell"><a href="/admin/home.php?edit='+d.idhome+'" class="linkurl">'+d.subject+'</a></td><td class="small-icon">'+metaTitle+'</td><td class="small-icon">'+metaDesc+'</td><td class="small-icon">'+d.iso+'</td><td class="small-icon">'+d.pseudo+'</td><td class="small-icon"><a class="post-preview" href="'+d.uri_home+'"><span style="float:left;" class="ui-icon ui-icon-zoomin"></span></a></td><td class="small-icon"><a href="/admin/home.php?edit='+d.idhome+'"><span style="float:left;" class="ui-icon ui-icon-pencil"></span></a></td><td class="small-icon"><a href="#" class="deletehome" rel="'+d.idhome+'"><span style="float:left;" class="ui-icon ui-icon-close"></span></a></td></tr>').appendTo("#table-list-home-page tbody")})}else{return $('<tr><td><span class="lfloat ui-icon ui-icon-minus"></span></td><td><span class="lfloat ui-icon ui-icon-minus"></span></td><td><span class="lfloat ui-icon ui-icon-minus"></span></td><td><span class="lfloat ui-icon ui-icon-minus"></span></td><td><span class="lfloat ui-icon ui-icon-minus"></span></td><td><span class="lfloat ui-icon ui-icon-minus"></span></td><td><span class="lfloat ui-icon ui-icon-minus"></span></td><td><span class="lfloat ui-icon ui-icon-minus"></span></td><td><span class="lfloat ui-icon ui-icon-minus"></span></td><td><span class="lfloat ui-icon ui-icon-minus"></span></td></tr>').appendTo("#table-list-home-page tbody")}$(".post-preview").colorbox({width:"95%",height:"95%",iframe:true})}})},_addNewHome:function(){$("#forms-add-home").submit(function(){$.nicenotify({ntype:"submit",uri:"/admin/home.php",typesend:"post",idforms:$(this),resetform:true,successParams:function(a){$.nicenotify.initbox(a);ns_jhome._homePageList()}});return false})},_editHome:function(){$("#forms-home-update").submit(function(){var a=$("#idhome").val();if(a!=null){$.nicenotify({ntype:"submit",uri:"/admin/home.php?edit="+a,typesend:"post",idforms:$(this),resetform:false,successParams:function(b){$.nicenotify.initbox(b);ns_jhome._homePageList()}});return false}else{console.log("%s: %o","homeid is null",a)}})},_deleteHome:function(){$(".deletehome").live("click",function(b){b.preventDefault();var a=$(this).attr("rel");$("#dialog_delete").dialog({bgiframe:true,resizable:false,height:140,modal:true,buttons:{Delete:function(){$(this).dialog("close");$.nicenotify({ntype:"ajax",uri:"/admin/home.php",typesend:"post",noticedata:"del_home="+a,successParams:function(c){$.nicenotify.initbox(c,{display:false});ns_jhome._homePageList()}})},Cancel:function(){$(this).dialog("close")}}})})},run:function(){this._initTextChange();this._homePageList();this._addNewHome();this._deleteHome()},runEdit:function(){this._initTextChange();this._homePageList();this._editHome();this._deleteHome()}};