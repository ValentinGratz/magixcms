/**
 * MAGIX CMS
 * @copyright  MAGIX CMS Copyright (c) 2011 - 2012 Gerits Aurelien, 
 * http://www.magix-cms.com, http://www.magix-cjquery.com
 * @license    Dual licensed under the MIT or GPL Version 3 licenses.
 * @version    0.2
 * @author Gérits Aurélien <aurelien@magix-cms.com>
 * @name ns_jnews
 * @update 10/10/2011 22:00
 */
var ns_jnews={_addNews:function(){$("#forms-news-add").submit(function(){$.nicenotify({ntype:"submit",uri:"/admin/news.php?add=true",typesend:"post",idforms:$(this),resetform:true});return false})},_editNews:function(a){$("#forms-news-update").submit(function(){$.nicenotify({ntype:"submit",uri:"/admin/news.php?edit="+a,typesend:"post",idforms:$(this),resetform:false,successParams:function(b){$.nicenotify.initbox(b);ns_jnews._load_page_uri(a)}});return false})},_editImage:function(a){$("#forms-news-image-update").submit(function(){$.nicenotify({ntype:"submit",uri:"/admin/news.php?edit="+a+"&post=1",typesend:"post",idforms:$(this),resetform:false,successParams:function(b){$("#n_image:file").val("");ns_jnews._LoadImageNews(a);$.nicenotify.initbox(b,{display:false})}});return false})},_LoadImageNews:function(a){$.nicenotify({ntype:"ajax",uri:"/admin/news.php?edit="+a+"&imgnews=true",typesend:"get",beforeParams:function(){$("#load_news_img #contener_image").html('<img src="/framework/img/square-circle.gif" />')},successParams:function(b){$("#load_news_img #contener_image").html(b)}})},_load_page_uri:function(a){$.nicenotify({ntype:"ajax",uri:"/admin/news.php?edit="+a+"&load_json_uri_news=true",typesend:"get",datatype:"json",beforeParams:function(){$("#newsurl").css({display:"none"}).val("");$('<span class="min-loader"><img src="/framework/img/small_loading.gif" /></span>').insertAfter("#newsurl")},successParams:function(b){$(".min-loader").remove();$.nicenotify.initbox(b,{display:false});var c=b.newsuri;$("#newsurl").css({display:"block"});$("#newsurl").val(c);$(".post-preview").attr({href:c})}})},_publishedNews:function(){$(".u-news-published").live("click",function(b){b.preventDefault();var a=$(this).attr("href");$("#confirm_published").dialog({resizable:false,height:140,width:320,modal:true,buttons:{"En ligne":function(){$(this).dialog("close");$.nicenotify({ntype:"ajax",uri:a,typesend:"post",noticedata:"status_news=1",successParams:function(c){$.nicenotify.initbox(c,{display:false,reloadhtml:true})}});return false},"Hors ligne":function(){$(this).dialog("close");$.nicenotify({ntype:"ajax",uri:a,typesend:"post",noticedata:"status_news=0",successParams:function(c){$.nicenotify.initbox(c,{display:false,reloadhtml:true})}});return false},Cancel:function(){$(this).dialog("close")}}})})},_deleteNews:function(){$(".deletenews").click(function(b){b.preventDefault();var a=$(this).attr("rel");$("#confirm_del").dialog({bgiframe:true,resizable:false,height:140,modal:true,title:"Suppression d'un article",buttons:{"Delete News":function(){$(this).dialog("close");$.nicenotify({ntype:"ajax",uri:"/admin/news.php",typesend:"post",noticedata:"delnews="+a,successParams:function(c){$.nicenotify.initbox(c,{display:false,reloadhtml:true})}})},Cancel:function(){$(this).dialog("close")}}})})},_google_chart_language:function(){$.nicenotify({ntype:"ajax",uri:"/admin/news.php?json_google_chart_news=true",typesend:"get",datatype:"json",beforeParams:function(){$("#chart-google-news").html('<img class="loader-block" src="/framework/img/square-circle.gif" />')},successParams:function(a){$("#chart-google-news").empty();$.nicenotify.initbox(a,{display:false});var b={title:"News Statistics",series:[{label:"News"},{label:"Tags"}],legend:{show:true,location:"ne",placement:"outsideGrid"},seriesColors:["#4bb2c5","#EAA228","#c5b47f","#579575","#839557","#958c12","#953579","#4b5de4","#d8b83f","#ff5800","#0085cc"],seriesDefaults:{min:1,shadow:true,renderer:$.jqplot.BarRenderer,rendererOptions:{barPadding:8,barMargin:10,fillToZero:true,barWidth:25}},axesDefaults:{tickOptions:{fontFamily:"Georgia",fontSize:"10pt"}},axes:{xaxis:{renderer:$.jqplot.CategoryAxisRenderer,ticks:a.lang},yaxis:{}}};$.jqplot("chart-google-news",[a.news_count,a.tag_count],b)}})},_addNewsTags:function(a){$("#form-assign-tagnews").submit(function(){$.nicenotify({ntype:"submit",uri:"/admin/news.php?edit="+a,typesend:"post",idforms:$(this),resetform:true,beforeParams:function(){$("#list_assign_tagnews").empty();$("#list_assign_tagnews").prepend('<img class="loader-block" src="/framework/img/square-circle.gif" />')},successParams:function(b){$.nicenotify.initbox(b,{display:false});ns_jnews._loadJsonListTagNews(a)}});return false})},_loadJsonListTagNews:function(a){$.nicenotify({ntype:"ajax",uri:"/admin/news.php?edit="+a+"&json_list_tag=true",typesend:"get",datatype:"json",beforeParams:function(){$("#list_assign_tagnews").html('<img class="loader-block" src="/framework/img/square-circle.gif" />')},successParams:function(b){$("#list_assign_tagnews").empty();$.nicenotify.initbox(b,{display:false});var c='<ul class="dctag"></ul>';$(c).appendTo("#list_assign_tagnews");if(b===undefined){console.log(b)}if(b!==null){$.each(b,function(d,e){return $('<li class="dctag-choice ui-state-default ui-corner-all">'+e.name_tag+'<a href="#" rel="'+e.idnews_tag+'" class="dctagclose del-tagnews">x</a></li>').appendTo(".dctag")})}else{return $("<li>Aucun tag</li>").appendTo(".dctag")}}})},_deleteTagNews:function(a){$(".del-tagnews").live("click",function(b){b.preventDefault();var c=$(this).attr("rel");$("#confirm_del").dialog({resizable:false,height:180,width:300,modal:true,buttons:{Confirm:function(){$(this).dialog("close");$.nicenotify({ntype:"ajax",uri:"/admin/news.php",typesend:"post",noticedata:"del_tag="+c,successParams:function(d){$.nicenotify.initbox(d,{display:false});ns_jnews._loadJsonListTagNews(a)}});return false},Cancel:function(){$(this).dialog("close")}}})})},run:function(){this._publishedNews();this._google_chart_language();this._deleteNews()},runAddNews:function(){this._addNews()},runEditNews:function(a){$("#n_uri").inputLock();this._load_page_uri(a);this._editNews(a);this._editImage(a);this._LoadImageNews(a);this._addNewsTags(a);this._loadJsonListTagNews(a);this._deleteTagNews(a)}};