/**
 * MAGIX CMS
 * @copyright  MAGIX CMS Copyright (c) 2011 - 2012 Gerits Aurelien, 
 * http://www.magix-cms.com, http://www.magix-cjquery.com
 * @license    Dual licensed under the MIT or GPL Version 3 licenses.
 * @version    0.2
 * @author Gérits Aurélien <aurelien@magix-cms.com>
 * @name ns_jnews
 *
 */
var ns_jnews={_addNews:function(){$("#forms-news-add").submit(function(){$(this).ajaxSubmit({url:"/admin/news.php?add=true",type:"post",resetForm:true,success:function(a){$.notice({ntype:"simple",time:2});$(".mc-head-request").html(a)}});return false})},_editNews:function(a){$("#forms-news-update").submit(function(){$(this).ajaxSubmit({url:"/admin/news.php?edit="+a,type:"post",resetForm:true,success:function(b){$.notice({ntype:"simple",time:2});ns_jnews._load_page_uri(a);$(".mc-head-request").html(b)}});return false})},_editImage:function(a){$("#forms-news-image-update").submit(function(){$(this).ajaxSubmit({url:"/admin/news.php?edit="+a+"&post=1",type:"post",resetForm:true,success:function(b){$("#n_image:file").val("");ns_jnews._LoadImageNews(a)}});return false})},_LoadImageNews:function(a){$.ajax({type:"get",statusCode:{0:function(){console.error("jQuery Error")},401:function(){console.warn("access denied")},404:function(){console.warn("object not found")},403:function(){console.warn("request forbidden")},408:function(){console.warn("server timed out waiting for request")},500:function(){console.error("Internal Server Error")}},url:"/admin/news.php?edit="+a+"&imgnews=true",async:true,cache:false,beforeSend:function(){$("#load_news_img #contener_image").html('<img src="/framework/img/square-circle.gif" />')},success:function(b){$("#load_news_img #contener_image").html(b)}})},_load_page_uri:function(a){$.ajax({url:"/admin/news.php?edit="+a+"&load_json_uri_news=true",dataType:"json",type:"get",statusCode:{0:function(){console.error("jQuery Error")},401:function(){console.warn("access denied")},404:function(){console.warn("object not found")},403:function(){console.warn("request forbidden")},408:function(){console.warn("server timed out waiting for request")},500:function(){console.error("Internal Server Error")}},async:true,cache:false,beforeSend:function(){$("#newsurl").css({display:"none"}).val("");$('<span class="min-loader"><img src="/framework/img/small_loading.gif" /></span>').insertAfter("#newsurl")},success:function(b){$(".min-loader").remove();var c=b.newsuri;$("#newsurl").css({display:"block"});$("#newsurl").val(c);$(".post-preview").attr({href:c})}})},_publishedNews:function(){$(".u-news-published").live("click",function(b){b.preventDefault();var a=$(this).attr("href");$("#confirm_published").dialog({resizable:false,height:140,width:320,modal:true,buttons:{"En ligne":function(){$(this).dialog("close");$.ajax({type:"post",url:a,data:"status_news=1",async:false,success:function(c){location.reload()}});return false},"Hors ligne":function(){$(this).dialog("close");$.ajax({type:"post",url:a,data:"status_news=0",async:false,success:function(c){location.reload()}});return false},Cancel:function(){$(this).dialog("close")}}})})},_deleteNews:function(){$(".deletenews").click(function(b){b.preventDefault();var a=$(this).attr("rel");$("#confirm_del").dialog({bgiframe:true,resizable:false,height:140,modal:true,title:"Suppression d'un article",buttons:{"Delete News":function(){$(this).dialog("close");$.ajax({type:"post",url:"/admin/news.php",data:"delnews="+a,async:false,cache:false,success:function(){location.reload()}})},Cancel:function(){$(this).dialog("close")}}})})},_google_chart_language:function(){$.ajax({url:"/admin/news.php?json_google_chart_news=true",dataType:"json",type:"get",statusCode:{0:function(){console.error("jQuery Error")},401:function(){console.warn("access denied")},404:function(){console.warn("object not found")},403:function(){console.warn("request forbidden")},408:function(){console.warn("server timed out waiting for request")},500:function(){console.error("Internal Server Error")}},async:true,cache:false,beforeSend:function(){$("#chart-google-news").html('<img class="loader-block" src="/framework/img/square-circle.gif" />')},success:function(a){$("#chart-google-news").empty();var b={title:"News Statistics",series:[{label:"News"},{label:"Tags"}],legend:{show:true,location:"ne",placement:"outsideGrid"},seriesColors:["#4bb2c5","#EAA228","#c5b47f","#579575","#839557","#958c12","#953579","#4b5de4","#d8b83f","#ff5800","#0085cc"],seriesDefaults:{min:1,shadow:true,renderer:$.jqplot.BarRenderer,rendererOptions:{barPadding:8,barMargin:10,fillToZero:true,barWidth:25}},axesDefaults:{tickOptions:{fontFamily:"Georgia",fontSize:"10pt"}},axes:{xaxis:{renderer:$.jqplot.CategoryAxisRenderer,ticks:a.lang},yaxis:{}}};$.jqplot("chart-google-news",[a.news_count,a.tag_count],b)}})},_addNewsTags:function(a){$("#form-assign-tagnews").submit(function(){$(this).ajaxSubmit({url:"/admin/news.php?edit="+a,type:"post",error:function(){alert("theres an error with AJAX")},beforeSubmit:function(){$("#list_assign_tagnews").empty();$("#list_assign_tagnews").prepend('<img class="loader-block" src="/framework/img/square-circle.gif" />')},success:function(b){ns_jnews._loadJsonListTagNews(a)},clearForm:true});return false})},_loadJsonListTagNews:function(a){$.ajax({url:"/admin/news.php?edit="+a+"&json_list_tag=true",dataType:"json",type:"get",async:true,cache:false,beforeSend:function(){$("#list_assign_tagnews").html('<img class="loader-block" src="/framework/img/square-circle.gif" />')},success:function(b){$("#list_assign_tagnews").empty();var c='<ul class="dctag"></ul>';$(c).appendTo("#list_assign_tagnews");if(b===undefined){console.log(b)}if(b!==null){$.each(b,function(d,e){return $('<li class="dctag-choice ui-state-default ui-corner-all">'+e.name_tag+'<a href="#" rel="'+e.idnews_tag+'" class="dctagclose del-tagnews">x</a></li>').appendTo(".dctag")})}else{return $("<li>Aucun tag</li>").appendTo(".dctag")}}})},_deleteTagNews:function(a){$(".del-tagnews").live("click",function(b){b.preventDefault();var c=$(this).attr("rel");$("#confirm_del").dialog({resizable:false,height:180,width:300,modal:true,buttons:{Confirm:function(){$(this).dialog("close");$.ajax({type:"post",url:"/admin/news.php",data:"del_tag="+c,async:false,success:function(d){ns_jnews._loadJsonListTagNews(a)}});return false},Cancel:function(){$(this).dialog("close")}}})})},run:function(){this._publishedNews();this._google_chart_language();this._deleteNews()},runAddNews:function(){this._addNews()},runEditNews:function(a){$("#n_uri").inputLock();this._load_page_uri(a);this._editNews(a);this._editImage(a);this._LoadImageNews(a);this._addNewsTags(a);this._loadJsonListTagNews(a);this._deleteTagNews(a)}};