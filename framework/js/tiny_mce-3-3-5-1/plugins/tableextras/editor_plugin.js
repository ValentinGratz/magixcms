(function(){tinymce.PluginManager.requireLangPack("tableextras");tinymce.create("tinymce.plugins.TableExtrasPlugin",{init:function(F,B){tinymce.DOM.loadCSS(B+"/css/tableextras.css");var E={rowSize:F.getParam("tableextras_row_size")||7,colSize:F.getParam("tableextras_col_size")||7};F.addCommand("teCmdTableDraw",function(){var Q=document.getElementById("te-panel");if(!Q||Q.style.display=="none"){G(F)}else{L()}});tinymce.dom.Event.add(document,"mousedown",function(Q){if(Q.target.parentNode.id!==(F.id+"_tabledraw")){if(!F.dom.getParent(Q.target,"div")){L();return }if(F.dom.getParent(Q.target,"div").id!=="te-table-border-color"){L()}}});F.addCommand("teCmdConvertCellsInRow",function(){C(F)});F.addButton("convertcellsinrow",{title:"tableextras.convertcellsinrow",cmd:"teCmdConvertCellsInRow",image:B+"/img/convert.gif"});F.addButton("tabledraw",{title:"tableextras.tabledraw",cmd:"teCmdTableDraw",image:B+"/img/table.gif"});F.onClick.add(function(Q){L()});F.onNodeChange.add(function(R,Q,S){Q.setDisabled("convertcellsinrow",(S.nodeName!="TD"&&S.nodeName!="TH"))});function G(R){if(tinymce.isIE){tinyMCE.activeEditor.objSelectionBoookmark=tinyMCE.activeEditor.selection.getBookmark()}var V;V=document.getElementById("te-panel");if(!V){V=A(R);document.getElementsByTagName("body")[0].appendChild(V)}var U=R.controlManager.get("tabledraw");var T=document.getElementById(U.id);var S=R.dom.getRect(T);V.controlButton=U;var Q=S.y+S.h;if(tinymce.isIE){Q=Q+M()[1]}V.style.top=Q+"px";V.style.left=S.x+"px";V.style.display="block";U.setActive(true);N()}function L(){var Q=document.getElementById("te-panel");if(!Q){return }Q.style.display="none";Q.controlButton.setActive(false)}function J(R){var Q=document.getElementById("te-panel");var Y=Q.getElementsByTagName("tr");var Z=Y.length;var X=R.row+1,V=R.col+1;var U,W;for(var T=0;T<Z;T++){U=Y[T].getElementsByTagName("td");W=U.length;for(var S=0;S<W;S++){if(S<V&&T<X){U[S].className="fill";document.getElementById("te-info").innerHTML=(T+1)+" x "+(S+1)}else{U[S].className="blank"}}}}function N(){var Q=document.getElementById("te-panel");var S=Q.getElementsByTagName("td");var T=S.length;for(var R=0;R<T;R++){S[R].className="blank"}}function A(S){var U=I("div",{id:"te-panel"});var R=I("div",{id:"te-table-border-color"});var T=P();var Q=I("div",{id:"te-info"});Q.innerHTML="0 x 0";Q.onmouseover=function(){var V=S.getLang("tableextras.tabledrawclose");this.innerHTML=V;this.title=V};Q.onclick=function(){L()};U.appendChild(R);R.appendChild(T);U.appendChild(Q);return U}function P(){var S=I("table",{id:"te-table",border:"0",cellSpacing:1,cellPadding:1});var W=I("tbody",{});var Q=E.rowSize,U=E.colSize;var V,X;for(var T=0;T<Q;T++){V=I("tr",{});W.appendChild(V);for(var R=0;R<U;R++){X=K(T,R);V.appendChild(X)}}S.appendChild(W);return S}function K(R,Q){var S=I("td",{row:R,col:Q});S.onmouseover=function(){J(this)};S.onmouseout=function(){J(this)};S.onclick=function(){D((this.row+1),(this.col+1));L()};return S}function D(Q,R){var W=tinyMCE.activeEditor;var S=W.dom;var Y='<table border="0" class="mceItemTable">\n';Y+="<tbody>\n";for(var V=0;V<Q;V++){Y+="<tr>\n";for(var T=0;T<R;T++){Y+="<td>&nbsp;</td>\n"}Y+="</tr>\n"}Y+="</tbody>\n";Y+="</table>\n";if(tinymce.isIE){W.selection.moveToBookmark(W.objSelectionBoookmark)}if(W.settings.fix_table_elements){var U=W.selection.getBookmark(),X="";W.execCommand("mceInsertContent",false,'<br class="_mce_marker" />');tinymce.each("h1,h2,h3,h4,h5,h6,p".split(","),function(Z){if(X){X+=","}X+=Z+" ._mce_marker"});tinymce.each(S.select(X),function(Z){S.split(S.getParent(Z,"h1,h2,h3,h4,h5,h6,p"),Z)});S.setOuterHTML(W.dom.select("._mce_marker")[0],Y);W.selection.moveToBookmark(U)}else{W.execCommand("mceInsertContent",false,Y)}W.addVisual()}function I(Q,S){var T=document.createElement(Q);for(var R in S){if(R=="style"){T[R].cssText=S[R]}else{T[R]=S[R]}}return T}function H(R,Q){var T=0;var U=Q.length;for(var S=0;S<U;S++){if(Q[S].nodeName==="TD"||Q[S].nodeName==="TH"){if(Q[S]===R){break}T++}}return T}function M(){var R=0,Q=0;if(typeof (window.pageYOffset)==="number"){Q=window.pageYOffset;R=window.pageXOffset}else{if(document.body&&(document.body.scrollLeft||document.body.scrollTop)){Q=document.body.scrollTop;R=document.body.scrollLeft}else{if(document.documentElement&&(document.documentElement.scrollLeft||document.documentElement.scrollTop)){Q=document.documentElement.scrollTop;R=document.documentElement.scrollLeft}}}return[R,Q]}function C(X){var T=X.selection;var a=T.getNode();var Y;var c;if(a.nodeName!="TD"&&a.nodeName!="TH"){return }c=X.dom.getParent(a,"tr");if(!c){return }Y=a.nodeName=="TD";var Q=c.childNodes;var Z=Q.length;var d=X.dom.create("tr");d=O(c,d);var S=H(a,Q);var U=Y?"th":"td";for(var W=0;W<Z;W++){if(Q[W].nodeName==="TD"||Q[W].nodeName==="TH"){var V=X.dom.create(U);V=O(Q[W],V);V.innerHTML=Q[W].innerHTML;d.appendChild(V)}}c.parentNode.insertBefore(d,c);c.parentNode.removeChild(c);var R=d.getElementsByTagName(U)[S];var b=tinymce.isIE?R:R.firstChild||R;T.select(b);T.collapse(0)}function O(Q,U){var T=Q.attributes;var S=T.length;for(var R=0;R<S;R++){if(T[R].nodeName==="style"){U.style.cssText=Q.style.cssText}else{if(T[R].nodeValue){F.dom.setAttrib(U,T[R].nodeName,T[R].nodeValue)}}}return U}},getInfo:function(){return{longname:"Table Extras plugin",author:"tan@enonic.com",authorurl:"http://www.enonic.com",infourl:"http://www.enonic.com",version:"1.4.0"}}});tinymce.PluginManager.add("tableextras",tinymce.plugins.TableExtrasPlugin)})();